{% extends 'moodiecinema/base.html' %}
{% load static %}

{% block head %}
<link rel="stylesheet" href="{% static 'statistics_self.css' %}">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
{% endblock %}

{% block content %}
<div class="statistics-container">
    <h1>CSV 데이터 분석 결과</h1>

    <!-- 연도별 영화 수 차트 -->
    <div class="chart-container">
        <h2>연도별 영화 수</h2>
        <canvas id="moviesByYearChart"></canvas>
    </div>

    <!-- 장르별 평균 평점 차트 -->
    <div class="chart-container">
        <h2>장르별 평균 평점</h2>
        <canvas id="genreAverageRatingsChart"></canvas>
    </div>

</div>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    $(document).ready(function () {
        $.ajax({
            url: "{% url 'self_statistics_api' %}",
            method: "GET",
            success: function (data) {
                // 연도별 영화 수 차트
                const moviesByYearCtx = document.getElementById('moviesByYearChart').getContext('2d');
                new Chart(moviesByYearCtx, {
                    type: 'bar',
                    data: {
                        labels: Object.keys(data.movies_by_year),
                        datasets: [{
                            label: '영화 수',
                            data: Object.values(data.movies_by_year),
                            backgroundColor: 'rgba(75, 192, 192, 0.2)',
                            borderColor: 'rgba(75, 192, 192, 1)',
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            legend: { display: false }
                        },
                        scales: {
                            y: { beginAtZero: true }
                        }
                    }
                });

                // 장르별 평균 평점 차트
                const genreAverageRatingsCtx = document.getElementById('genreAverageRatingsChart').getContext('2d');
                new Chart(genreAverageRatingsCtx, {
                    type: 'bar',
                    data: {
                        labels: Object.keys(data.genre_average_ratings),
                        datasets: [{
                            label: '평균 평점',
                            data: Object.values(data.genre_average_ratings),
                            backgroundColor: 'rgba(153, 102, 255, 0.2)',
                            borderColor: 'rgba(153, 102, 255, 1)',
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            legend: { display: false }
                        },
                        scales: {
                            y: { beginAtZero: true }
                        }
                    }
                });
            },
            error: function (err) {
                console.error("Error loading statistics:", err);
            }
        });
    });
</script>
{% endblock %}